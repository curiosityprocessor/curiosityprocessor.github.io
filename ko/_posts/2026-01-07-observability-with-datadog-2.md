---
title: "Datadog을 통한 Observability 확보 여정 #2"
date: 2025-12-30
lang: ko
categories:
  - DevOps
tags:
  - DevOps
  - Solutions
excerpt: "#2 장애 예방, 탐지, 대응 절차"
---

# 지금까지의 여정 정리
지금까지의 여정을 정리해보자.  
Datadog을 통한 observability 확보로 우리 팀은 장애를 "**시간의 흐름**" 에 따라 인지할 수 있게 되었다.
- 장애 발생 전: **예방** 단계
- 장애 발생 시: **탐지** 단계
- 장애 발생 후: **대응** 단계

## 장애 예방 단계
### 시스템 레벨
대시보드로 집계한 여러 metrics에 대한 분석을 통해  
API 호출 패턴이나 레이턴시에 대한 분석으로 **잠재적으로 이슈**가 발생할 수 있는 API를 미리 튜닝한다던가  
예상 사용량 대비 실제 사용량을 비교해보고 auto-scaling **수치를 튜닝**한다던가 하는 작업이 가능해졌다.  
서버의 CPU/메모리나 Database ACU와 같은 수치도 사용량 대비 검증하며 적절한 값을 찾아갈 수 있었다.  
특히 람다와 같이 수행시간이나 memory와 같은 자원이 한정된 edge 환경에서 리소스 조정이나 튜닝이 필요한지 확인할 수 있었다.  
장애 예방을 위한 시스템 설정값을 더 이상 **감이 아니라 데이터로 검증**할 수 있게 되었다.  

### 코드 레벨
코드 레벨에서는 APM 의 기능으로 제공하는 **취약점 분석**을 통해 보안 취약한 코드를 분석하고 개선할 수 있게 되었다.  
예를 들어 압축파일의 비밀번호를 사용자에게 입력받아 압축해주는 서비스에서  
비밀번호에 악의적인 코드를 심어 command injection이나 path traversal이 가능하다는 취약점을 제보 받고  
관련 코드에서 허용문자만 강제하도록 개선하였다.  

여기까지 장애가 발생하기 전 예방 단계의 조치이나, 사실 장애로 발전하기 이전 _잠재적 이슈의 사전탐지_ 부분이 컸다.  
"**예방**"이 좀 더 강조되기 위해서는 테스트 자동화, 코드 정적/동적 분석 자동화와 같은 **검증 단계를 개발 라이프싸이클에 통합**시키거나    
요청량이나 레이턴시와 같은 분석으로 특정 페이지나 API는 **어떤 개선이 필요한지 리포팅과 일감 생성으로 연계** 된다면 좋겠다고 생각했다.  

---

## 장애 탐지 단계
장애 탐지의 목적은 모든 것을 볼 수 있는 대시보드를 기본으로 두되, 주요 지표는 즉각적인 알림으로 **빠르게 인지**시키는 것이었다.  
API 평균 레이턴시, Database connection 수와 같은 **시스템 지표**부터,  
프론트, 백엔드 에러, DB SQL 에러 등 핵심 **에러 알림**까지  
장애로 판단될만한 이슈가 생기면 즉각적으로 알림 받을 수 있게 연동했다.  
팀의 특성 상 특정한 서비스나 모듈별로 **DRI** (Directly Responsible Individual:직접 책임자)를 지정하기는 어려워  
크게 프론트엔드/백엔드 단위로 태그를 걸어 함께 모니터링하고 대처할 수 있게 유도했다.  

---

## 장애 대응 단계
장애 대응은 장애 탐지, 또는 제보로부터 시작하여 해당 이슈가 **어떤 것 때문에 발생했고 어떻게 해결할 수 있는지**를 파악하는 단계이다.  
알림 받은 서비스와 trace 정보로부터 연관된 프론트/백엔드 요청을 넘나들며 추적하고  
어떤 기업의 누가 요청했는 지를 알고 있기에 동일 요청에 대해 에러 비율을 전체 또는 기업별로 비교해볼 수 있었고  
필요 시 DB를 찾아보거나 직접 역으로 컨택해 이슈 제보를 받거나 악의성을 검증할 수도 있었다.  

이를 통해 제보 받은 장애가 전역적인 이슈인지 특수 케이스에서만 발생하는지 장애 범위를 빠르게 볼 수 있었고  
정확한 에러메시지와 에러가 발생한 코드 베이스까지 빠르게 찾을 수 있어 일시적인 이슈인지 재현 가능한 오류인지도 파악할 수 있었다.  

다만 현 단계에서 아쉬웠던 점도 분명히 있었다.
- 장애가 등급화되어 있지 않아 즉각적으로 대처가 필요한 것과 아닌 것의 우선순위 구분이 없었다는 점  
- DRI가 불분명하기 때문에 원인파악 하고 근본적인 해결을 담당하는 사람과 즉각적인 이슈 대응을 하는 사람의 역할분담이 부족했다는 점  
- 결과적으로 프로세스가 정립되지 않아 대처상의 혼선과 중복이 발생하고 있다는 점이다.  
